{"version":3,"file":"wkrk.cjs","sources":["../src/index.ts"],"sourcesContent":["import { ExtendedResponse } from \"wkrk-extended\";\nimport { ExtendedRequest } from \"wkrk-extended\";\n\ntype Handler =\n  | undefined\n  | ((req: Request, res: ExtendedResponse) => Response)\n  | ((req: Request, res: ExtendedResponse) => Promise<Response>);\n\ntype MethodType = \"get\" | \"post\" | \"put\" | \"delete\";\n\ntype Path = {\n  get?: Handler;\n  post?: Handler;\n  put?: Handler;\n  delete?: Handler;\n  handler?: Handler;\n  default?: {\n    get?: Handler;\n    post?: Handler;\n    handler?: Handler;\n    put?: Handler;\n    delete?: Handler;\n  };\n};\n\ntype RouteType = {\n  [key: string]: Path;\n};\n\nconst getHandler = (req: Request, pathHandler: Path) => {\n  const method = req.method.toLowerCase();\n  if ([\"get\", \"post\", \"put\", \"delete\"].includes(method)) {\n    return (\n      pathHandler[method as MethodType] ||\n      pathHandler.default?.[method as MethodType] ||\n      pathHandler.handler\n    );\n  }\n\n  return pathHandler.handler;\n};\n\nconst pathIsInRoutes = (routes: RouteType, path: string) =>\n  Object.keys(routes).includes(path);\n\nexport const wkrk = (routes: RouteType) => ({\n  async fetch(req: Request) {\n    const requestProxy = new ExtendedRequest(req);\n    const responseProxy = new ExtendedResponse();\n    const pathname = new URL(req.url).pathname;\n    const pathHandler = routes[pathname];\n    if (!pathHandler) {\n      const errorMessage = `Don't know how to handle the ${pathname} path. Check your routes configuration.`;\n      return responseProxy.error(errorMessage);\n    }\n    const handler = getHandler(req, pathHandler);\n    if (!handler) {\n      const errorMessage = `Unknown request method: ${req.method}`;\n      return responseProxy.error(errorMessage);\n    }\n\n    return handler(req, responseProxy);\n  },\n});\n"],"names":["routes","fetch","req","ExtendedResponse","pathname","URL","url","pathHandler","responseProxy","error","handler","_pathHandler$default","method","toLowerCase","includes","getHandler","e","Promise","reject"],"mappings":"4CA6CoB,SAACA,GAAuB,MAAA,CACpCC,MAAMC,SAAAA,OACW,sBAAoBA,GAAzC,MACsB,MAAtBC,iBACcC,EAAG,IAAIC,IAAIH,EAAII,KAAKF,SAC5BG,EAAcP,EAAOI,GAC3B,IAAKG,EAEH,uBAAOC,EAAcC,MADgCL,gCAAAA,EAArD,4CAGF,IAAMM,EA1BS,SAACR,EAAcK,GAChC,IAEEI,EAFUC,EAAGV,EAAIU,OAAOC,cAC1B,MAAI,CAAC,MAAO,OAAQ,MAAO,UAAUC,SAASF,KAE/BL,EAACK,KAAZ,OAAAD,EACAJ,EADA,cAAA,EACAI,EAAsBC,MAKnBL,EAAYG,QAgBDK,CAAWb,EAAKK,GAChC,OAKOG,QAAAA,QALFA,EAKEA,EAAQR,EAAKM,GAHXA,EAAcC,iCAD2BP,EAAIU,SAZd,MAAAI,GAAA,OAAAC,QAAAC,OAAAF"}